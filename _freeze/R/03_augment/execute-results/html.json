{
  "hash": "51985496689f1170481f5c77196f6f11",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"03 - augment\"\nformat: html\neditor: visual\nexecute:\n  cache: false\n---\n\n## Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'tidyverse' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'ggplot2' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'readr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'purrr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'stringr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'forcats' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(\"dplyr\")\n```\n:::\n\n\n## Load cleaned tables\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngen_exp_clean <- readRDS(\"../data/gen_exp_clean.rds\")\nphenotype_clean <- readRDS(\"../data/phenotype_clean.rds\")\n```\n:::\n\n\n## Reshape gene expression table\n\nThe current gene expression dataset is in a wide format:\\\nrows = genes columns = samples\\\nFor further analyses, it is more convenient to work in a long format: one row per (gene × sample) measurement. The dataset is now tidy.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngen_exp_long <- gen_exp_clean |>\n  pivot_longer(cols = -c(Ensembl_ID, sum_gene_exp),\n               names_to = \"sample\",\n               values_to = \"expression\"\n               )\n\ngen_exp_long |> \n  slice_sample(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 4\n   Ensembl_ID         sum_gene_exp sample           expression\n   <chr>                     <dbl> <chr>                 <dbl>\n 1 ENSG00000196814.15         631. TCGA-24-2262-01A       1.35\n 2 ENSG00000162972.10        1484. TCGA-61-1743-01A       3.88\n 3 ENSG00000154760.14         961. TCGA-23-1119-01A       2.21\n 4 ENSG00000006757.12        1315. TCGA-13-0766-01A       4.18\n 5 ENSG00000153485.6         1060. TCGA-09-1667-01C       2.48\n 6 ENSG00000262902.1         1498. TCGA-29-1698-01A       3.29\n 7 ENSG00000174529.7          607. TCGA-25-1319-01A       1.36\n 8 ENSG00000231074.9          661. TCGA-13-0795-01A       1.31\n 9 ENSG00000197265.9         1450. TCGA-24-0979-01A       2.72\n10 ENSG00000125740.14        1255. TCGA-04-1514-01A       4.97\n```\n\n\n:::\n:::\n\n\n## Join clinical metadata\n\nNow we merge the gene expression table with the phenotype table using the common identifier sample.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Merge expression data with phenotype metadata\nfull_data <- gen_exp_long |>\n  left_join(phenotype_clean, by = \"sample\") |>\n  relocate(sample, .before = Ensembl_ID)\n\nfull_data |> \n  slice_sample(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 52\n   sample           Ensembl_ID         sum_gene_exp expression race.demographic\n   <chr>            <chr>                     <dbl>      <dbl> <chr>           \n 1 TCGA-30-1860-01A ENSG00000214013.9          434.      0.900 white           \n 2 TCGA-30-1860-01A ENSG00000141873.11         955.      2.38  white           \n 3 TCGA-24-1469-01A ENSG00000164142.16         535.      1.82  white           \n 4 TCGA-24-1849-01A ENSG00000171067.11        1743.      4.35  white           \n 5 TCGA-61-2110-01A ENSG00000170473.17        1680.      3.63  white           \n 6 TCGA-25-1316-01A ENSG00000175315.3         1151.      0.903 white           \n 7 TCGA-04-1651-01A ENSG00000234160.1         1062.      1.60  white           \n 8 TCGA-13-0888-01A ENSG00000153922.11         731.      2.09  white           \n 9 TCGA-24-1467-01A ENSG00000198040.11         792.      2.77  white           \n10 TCGA-04-1519-01A ENSG00000168214.20        1425.      3.85  not reported    \n# ℹ 47 more variables: ethnicity.demographic <chr>, alive <lgl>,\n#   age_at_index.demographic <dbl>, days_to_birth.demographic <dbl>,\n#   year_of_birth.demographic <dbl>, days_to_death.demographic <dbl>,\n#   year_of_death.demographic <dbl>, code.tissue_source_site <chr>,\n#   name.tissue_source_site <chr>, bcr_id.tissue_source_site <chr>,\n#   notes.annotations <chr>, submitter_id.annotations <chr>,\n#   classification.annotations <chr>, created_datetime.annotations <chr>, …\n```\n\n\n:::\n:::\n\n\nWe now have: biological measurements (gene-exp) + patient characteristics (phenotype).\n\n## Create additional variables\n\nWe can also create new useful variables like:\n\n-   A log-transformed expression variable (log2_expression), commonly used in transcriptomics to reduce skewness and easier interpretation.\n\n-   A categorical age variable (age_cat), based on common thresholds in clinical studies.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_data <- full_data |>\n  mutate(log2_expression = log2(expression + 1),\n         age_cat = case_when(\n           age_at_index.demographic < 50 ~ \"young\",\n           age_at_index.demographic >= 50 & age_at_index.demographic < 65 ~ \"middle\",\n           age_at_index.demographic >= 65 ~ \"senior\",\n           TRUE ~ NA_character_)\n         )\n\nfull_data |> \n  slice_sample(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 54\n   sample           Ensembl_ID         sum_gene_exp expression race.demographic \n   <chr>            <chr>                     <dbl>      <dbl> <chr>            \n 1 TCGA-23-1022-01A ENSG00000160188.10         720.      0.843 white            \n 2 TCGA-09-0367-01A ENSG00000254415.3          466.      0.851 native hawaiian …\n 3 TCGA-13-0887-01A ENSG00000161956.13         923.      1.88  white            \n 4 TCGA-25-1626-01A ENSG00000105176.18        1953.      4.23  white            \n 5 TCGA-29-2414-02A ENSG00000122861.16        1537.      2.73  white            \n 6 TCGA-29-1785-01A ENSG00000078177.14         522.      0.918 white            \n 7 TCGA-13-0886-01A ENSG00000107140.16        1871.      4.31  white            \n 8 TCGA-29-1769-01A ENSG00000113721.14        1303.      2.79  white            \n 9 TCGA-59-A5PD-01A ENSG00000187479.8         1178.      3.28  black or african…\n10 TCGA-29-1777-01A ENSG00000176371.14         487.      0.976 white            \n# ℹ 49 more variables: ethnicity.demographic <chr>, alive <lgl>,\n#   age_at_index.demographic <dbl>, days_to_birth.demographic <dbl>,\n#   year_of_birth.demographic <dbl>, days_to_death.demographic <dbl>,\n#   year_of_death.demographic <dbl>, code.tissue_source_site <chr>,\n#   name.tissue_source_site <chr>, bcr_id.tissue_source_site <chr>,\n#   notes.annotations <chr>, submitter_id.annotations <chr>,\n#   classification.annotations <chr>, created_datetime.annotations <chr>, …\n```\n\n\n:::\n:::\n\n\nThe +1 in the log transformation prevents issues when expression = 0. (goes to -inf with log)\n\nNA_character\\_ ensures that missing age values remain coded as valid character-type missing values in the age category variable.\n\n## Save augmented dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(full_data, \"../data/data_augmented.rds\")\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}