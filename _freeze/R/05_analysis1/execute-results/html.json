{
  "hash": "40d59c1cf3e9ea8ac66153d2445a4076",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"05 - analysis 1\"\nformat: html\neditor: visual\nexecute:\n  cache: false\n---\n\n### Loading libraries and data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"tidyverse\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'tidyverse' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'ggplot2' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'readr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'purrr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'stringr' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: le package 'forcats' a été compilé avec la version R 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load 3 tables\nphenotype <- readRDS(\"../data/phenotype_clean.rds\")\ngen_exp <- readRDS(\"../data/gen_exp_clean.rds\")\ndata_augmented <- readRDS(\"../data/data_augmented.rds\")\n```\n:::\n\n\n## Distribution of the variables\n\nage : dans describe\n\nfigo stage : We can see that most of the patients are in stage IIIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_augmented |>\n  group_by(sample) |>\n  slice(1) |>\n  filter(!is.na(figo_stage.diagnoses)) |>\n  ggplot(aes(x = figo_stage.diagnoses)) +\n    geom_bar() +\n    labs(title = \"distribution of FIGO stages\",\n       x = \"FIGO stage\",\n       y = \"number of patients\")\n```\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nalive vs dead : we can see that there is more dead patients than alive\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_augmented |>\n  group_by(sample) |>\n  slice(1) |>\n  ggplot(aes(x = alive)) +\n    geom_bar() +\n    labs(title = \"distribution of alive patients\",\n       x = \"alive\",\n       y = \"number of patients\")\n```\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nprimary vs recurent tumor : we can see that for most of the patients, the tumor is primary\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_augmented |>\n  group_by(sample) |>\n  slice(1) |>\n  ggplot(aes(x = tumor_descriptor.samples)) +\n    geom_bar() +\n    labs(title = \"distribution of primary vs recurent tumor\",\n       x = \"primary vs recurent\",\n       y = \"number of patients\")\n```\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\ntypes of treatment : the types of treatment are almost equally distributed\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_augmented |>\n  group_by(sample) |>\n  slice(1) |>\n  ggplot(aes(x = treatment_type.treatments.diagnoses)) +\n    geom_bar() +\n    scale_x_discrete(labels = c(\n      \"['Pharmaceutical Therapy, NOS', 'Radiation Therapy, NOS']\" = \"pharmaceutical before radiation\",\n      \"['Radiation Therapy, NOS', 'Pharmaceutical Therapy, NOS']\" = \"radiation before pharmaceutical\")) +\n    labs(title = \"distribution of ptypes of treatment\",\n       x = \"types of treatment\",\n       y = \"number of patients\")\n```\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select most variable gene\ngene_var <- data_augmented |>\n  group_by(Ensembl_ID) |>\n  summarise(var_log2 = var(log2_expression, na.rm = TRUE), .groups = \"drop\") |>\n  arrange(desc(var_log2))\n\n# Choose the top variable gene\ngene_x <- gene_var$Ensembl_ID[1]\n\n# Filter data for this gene and compute survival duration\ndf_gene <- data_augmented |>\n  filter(Ensembl_ID == gene_x) |>\n  mutate(\n    survival_days = case_when(\n      alive == TRUE  ~ days_to_last_follow_up.diagnoses,\n      alive == FALSE ~ days_to_death.demographic,\n      TRUE ~ NA_real_\n    )\n  )\n\n# -------------------------------------------------------------\n# Boxplot: Expression vs Alive\n# -------------------------------------------------------------\nggplot(df_gene, aes(x = alive, y = log2_expression)) +\n  geom_boxplot(fill = \"#a6cee3\") +\n  labs(\n    title = paste(\"Expression of gene\", gene_x, \"in alive vs dead patients\"),\n    x = \"Alive status\",\n    y = \"log2(expression)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# -------------------------------------------------------------\n# Scatter plot + Regression: Survival vs Expression\n# -------------------------------------------------------------\nggplot(df_gene, aes(x = log2_expression, y = survival_days, color = alive)) +\n  geom_point(alpha = 0.7) +\n  geom_smooth(method = \"lm\", se = TRUE) +\n  labs(\n    title = paste(\"Survival time vs expression for gene\", gene_x),\n    x = \"log2(expression)\",\n    y = \"Survival (days)\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](05_analysis1_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# -------------------------------------------------------------\n# Linear model summary\n# -------------------------------------------------------------\nlm(survival_days ~ log2_expression, data = df_gene) |> summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = survival_days ~ log2_expression, data = df_gene)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1209.1  -712.5  -187.7   504.6  4260.3 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      1220.72      60.00   20.35   <2e-16 ***\nlog2_expression   -28.60      38.68   -0.74     0.46    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 951.8 on 425 degrees of freedom\n  (2 observations effacées parce que manquantes)\nMultiple R-squared:  0.001285,\tAdjusted R-squared:  -0.001065 \nF-statistic: 0.5469 on 1 and 425 DF,  p-value: 0.46\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "05_analysis1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}