---
title: "02 - clean"
format: html
editor: visual
---

## Load libraries

```{r}
library("tidyverse")
library("dplyr")
```

## Clean gene table

```{r}
gen_exp <- readRDS("../data/gen_exp.rds")
dim(gen_exp)
gen_exp |> 
  slice_sample(n = 10)
```

We have 60600 observations (rows) and 430 variables (columns). The rows are the different genes and the columns are the samples. We have 60600 genes (that is too much) and we can see that some of them are 0 for all the samples. So we want to delete all the gene with no expression for each sample.

```{r}
gen_exp_clean <- gen_exp |>
  filter(rowSums(across(-Ensembl_ID)) != 0)
dim(gen_exp_clean)
```

We steel have too much genes (57825) so we want to see which genes are unuseful

We calculate the sum of all the gene expression for each gene

```{r}
gen_exp_clean <- gen_exp_clean |>
  mutate(sum_gene_exp = rowSums(across(-Ensembl_ID))) |>
  relocate(sum_gene_exp, .after = Ensembl_ID) |>
  arrange(sum_gene_exp)
gen_exp_clean |> 
  slice_sample(n = 10)
```

Now we want to visualise this new varaible to know what treshold we are going to use to select the relevant genes

```{r}
ggplot(gen_exp_clean, aes(x = Ensembl_ID, y = sum_gene_exp)) +
  geom_point()
ggplot(gen_exp_clean, aes(x = sum_gene_exp)) +
  geom_histogram(binwidth = 100)
ggplot(gen_exp_clean, aes(y = sum_gene_exp)) +
  geom_boxplot()
```

We can see that a lot of genes have the sum around 0 (with the boxplot). In the histogram, the binwidth is 100 and 4 bars are higher than the others and correspond to irelevant genes. So we can choose a treshold of 400. There are 431 samples so a threshold of 400 means that in average, apromimativelly all the genes expressions are higher than 1.

```{r}
gen_exp_clean <- gen_exp_clean |>
  filter(sum_gene_exp > 400)
dim(gen_exp_clean)
```

```{r}
ggplot(gen_exp_clean, aes(x = sum_gene_exp)) +
  geom_histogram(binwidth = 100)
```

Now, we have 14157 genes which is more appropriate for our case.
