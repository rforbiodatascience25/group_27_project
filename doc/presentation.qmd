---
title: "Presentation"
author: "Emily Möller (s251702), Erine Genilloud (s252025), Mazarine Chambon (s251918), Yann Ducrest (s251889), Hedi Khemakhem (s251900)"
format:
  revealjs:
    theme: moon
    css: styles.css
editor: visual
execute:
  working-directory: here
---

## Introduction

### **Context**

-   TCGA ovarian cancer dataset combining clinical records and transcriptomic profiles.

-   Enables large-scale exploration of molecular heterogeneity in ovarian cancer.

### **Objective**

-   Link **gene expression patterns** with **clinical characteristics** and **patient outcomes**.

### **Approach**

![](../results/Flowchart.svg)

## Materials - Load

```{r}
#| echo: false
#| eval: true 
     
library("tidyverse")
```

```{r}
#| echo: false
#| eval: true 

phenotype <- readRDS("../data/phenotype_clean.rds")
gen_exp <- readRDS("../data/gen_exp_clean.rds")
phenotype_og <- readRDS("../data/phenotype.rds")
data_augmented <- readRDS("../data/data_augmented.rds")
```

### Article

**Comparison of gene expression patterns across twelve tumor types identifies a cancer supercluster characterized by TP53 mutations and cell cycle defects**

### Dataset

#### [Gene expression dataset]{.underline}

-   TCGA ovarian cancer cohort
-   **FPKM** = *Fragments Per Kilobase of transcript per Million mapped reads* → normalized gene-expression metric
-   **Format:** TSV (`TCGA-OV.star_fpkm.tsv`)
-   **Dimensions:** **60 660 genes** × **430 samples**

#### [Clinical dataset]{.underline}

-   Patient phenotype / clinical variables from TCGA-OV

-   **Format:** TSV (`TCGA-OV.clinical.tsv`)

-   **Dimensions:** **632 patients** × **84 clinical variables**

### Source

**The Cancer Genome Atlas (TCGA) – Ovarian cancer collection**

## Methods - Clean 1 : Gene table

Too many genes in the dataset for analysis (60 600 genes)

1.  Delete all genes with no expression for each sample\
2.  Find non-relevant genes:
    -   Calculate the sum of expression for each gene\
    -   Plot the sum to choose a threshold\
    -   Remove genes under this threshold

→ [**Final number of genes: 14 157**]{style="color:#f8a47d;"}

```{r}
knitr::kable(head(gen_exp, 8))
```

## Methods - Clean 2 : Phenotype table

::::: columns
::: column
*Removal of [columns]{style="color:#f8a47d;"}:*

-   Long lists of characters used for identification

-   Repeated content in different columns

-   Columns with the same observation for each sample

-   Columns with "NA" or "Not reported" for each row

-   Replace categorical variable with 2 possible cases by a boolean

*Removal of [rows]{style="color:#f8a47d;"}:* 8 samples with NAs for (almost) all columns
:::

::: column
```{r}
#| echo: true    # show code
#| eval: false   # don't run it
phenotype_clean <- phenotype_clean |> 
  mutate(
    vital_status.demographic = case_when(
      vital_status.demographic == "Alive" ~ TRUE,
      vital_status.demographic == "Dead" ~ FALSE,
      TRUE ~ NA)
    )|>
  rename(alive=vital_status.demographic)

```
:::
:::::

```{r}
#| echo: false    # don't show code
#| eval: true     # run it

# Show repetitive content
table1 <- phenotype_og |> 
  slice_sample(n = 10) |> 
  select(c(sample, submitter_id))

# Show alive/dead old variable
table2 <- phenotype_og |>
  slice_head(n = 10)

# Show alive/dead new variable
table3 <- phenotype |>
  slice_head(n = 10)

# Combine columns for presentation
table4 <- bind_cols(
  table2 |> select(vital_status.demographic),
  table3 |> select(alive)
)

```

::::: columns
::: column
```{r}
knitr::kable(head(table1, 8))

```
:::

::: column
```{r}
knitr::kable(head(table4, 8))


```
:::
:::::

## Methods - Augment

::::: columns
::: column
### 1. Reshape

-   Convert gene-expression table **wide → long**\
    (1 row = 1 gene × 1 sample)

### 2. Join

-   Merge **gene expression + clinical phenotype**\
    using the identifier **sample**

### 3. Create

-   `log2_expression` (variance-stabilized)
-   `age_cat` (young / middle / senior)

**Output:** one **tidy**, **merged**, **augmented** dataset\
(saved as `data_augmented.rds`)
:::

::: column
```{r}
#| echo: true 
#| eval: false  

gen_exp_long <- gen_exp_clean |> 
  pivot_longer(
    cols = -Ensembl_ID,
    names_to = "sample",
    values_to = "expression"
  )



full_data <- gen_exp_long |> 
  left_join(phenotype_clean, by = "sample") |> 
  relocate(sample, .before = Ensembl_ID)



full_data <- full_data |> 
  mutate(
    log2_expression = log2(expression + 1),
    age_cat = case_when(
      age_at_index.demographic < 50 ~ "young",
      age_at_index.demographic < 65 ~ "middle",
      age_at_index.demographic >= 65 ~ "senior",
      TRUE ~ NA_character_
    )
  )
```
:::
:::::

```{r}
data_augmented |> 
  select(
    sample, 
    Ensembl_ID, 
    expression, 
    race.demographic, 
    alive
  ) |> 
  slice_head(n = 3) |> 
  knitr::kable()
```

## Methods - Describe

#### **Full data**

-   Size: 6'073'353 samples (rows), 53 variables (columns)
-   Impacted variable: figo_stage.diagnosis (cancer stage)
-   Quality and integrity


![](plots/04_age_tumorstage.png)


## Methods - Analysis 1

::::: columns
::: column
[*Analysis of the distribution of variables*]{style="color:#f8a47d;"}

-   Grouping by sample

-   Plot for FIGO stage, alive status, age, etc.

→ No correlation was found, but this allowed us to conclude that the phenotype data set lacked sufficient variability to reveal real biological effects.

[*Biological relevance of most variant genes*]{style="color:#f8a47d;"}

-   Extract top 10 genes with most variance

-   Translate Ensembl ID to gene code

-   The genes found are all immunoglobulin genes, which reflect variance in immune involvement among patients

| Ensembl_ID        | Gene symbol |
|-------------------|-------------|
| ENSG00000211592.8 | IGKC        |
| ENSG00000211896.7 | IGHG1       |
| ENSG00000239951.1 | IGKV3-20    |
| ENSG00000211598.2 | IGKV4-1     |
| ENSG00000253755.1 | IGHGP       |
:::

::: column
```{r}
#| echo: true      # show code
#| eval: false     # don’t run it

data_augmented |>
  group_by(sample) |>
  slice(1) |>
  ggplot(aes(x = figo_stage.diagnoses)) +
    geom_bar()

```

![](../results/05_figo_stages.png){width="70%"}

![](../results/05_immune_ethnicity.png){width="85%"}
:::
:::::

## Methods - Analysis 2 : PCA on gene expression (top 500 most variable genes)

::::: columns
::: column
[*Aim*]{style="color:#f8a47d;"}

-   Explore global structure of RNA-seq data\
-   Check if patients separate by:
    -   **survival status** (alive vs dead)
    -   **age category**

[*Approach*]{style="color:#f8a47d;"}

-   Use augmented dataset (`data_augmented`)
-   Select **500 most variable genes** (variance of log2 expression)
-   Build sample × gene matrix
-   Run **PCA** on centred & scaled expression

[*Key result*]{style="color:#f8a47d;"}

-   PC1 captures most of the variance
-   **No visible clustering** by survival or age\
    → main transcriptomic variation **not explained** by these clinical variables
:::

::: column
![](../results/06_pca_scree.png){width="80%"} ![](../results/06_pca_pc1_pc2.png){width="80%"}
:::
:::::

## Methods - Analysis 3 : Differential expression: alive vs dead

::::: columns
::: column
[*Aim*]{style="color:#f8a47d;"}

-   Test whether gene expression differs\
    between **alive** and **dead** patients.

[*Methods*]{style="color:#f8a47d;"}

-   Augmented dataset (`data_augmented`)
-   Kept samples with known **alive** status

[*Key result*]{style="color:#f8a47d;"}

-   \~14,157 genes tested
-   **Only 2 genes** significant at FDR \< 0.05\
    (\~0.014% of all genes)
-   Most genes have **very small** log2 fold changes

[*Conclusion*]{style="color:#f8a47d;"}

-   Vital status has only a **weak effect**\
    on gene expression at the genome-wide level\
    → consistent with PCA (no clear separation)
:::

::: column
![](../results/07_volcano_alive_vs_dead.png){width="80%"} ![](../results/07_boxplots_alive_vs_dead.png){width="80%"}
:::
:::::

## Discussion

1. <span style="color:#f8a47d;">Clinical variables distributions</span><br>
   When exploring the clinical variables, we found that the dataset is **extremely unbalanced**:  
   most patients have late stage ovarian cancer, with very similar ages and clinical characteristics.
   → This **lack of variability** reduces our ability to detect strong associations.
   <br>

2. <span style="color:#f8a47d;">*PCA of gene expression*</span><br>
   PCA on the most variable genes showed **no clustering** for age, survival or any other phenotype.  
   → This indicates that the **main differences in gene expression** across patients do **not correspond** to the clinical groups tested.
   <br>

3. <span style="color:#f8a47d;">*Differential expression*</span><br>
   Differential expression showed that **only two** genes remained significant after FDR correction.  
   → Survival is therefore **not associated with strong transcriptomic changes** in this cohort.
   <br><br>

### **Conclusion**

Overall, our analyses show that the **TCGA-OV dataset lacks sufficient clinical and molecular variability** to identify transcriptomic signatures linked to survival or other phenotypes.  

Most patients share the **same tumor type** and **late disease stage**, which likely masks underlying biological differences.  

Therefore, in this cohort, **no strong conclusion can be drawn** regarding gene-expression predictors of clinical outcomes.

